<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>md-loaderè¯¦è§£ | City Corner</title>
<meta name="description" content="è„šè¸å®åœ° ä»°æœ›æ˜Ÿç©º">

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://chentianyuan.github.io/favicon.ico?v=1588002283877">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://chentianyuan.github.io/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>

<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />



  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://chentianyuan.github.io">
        <img src="https://chentianyuan.github.io/images/avatar.png?v=1588002283877" class="site-logo">
        <h1 class="site-title">City Corner</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
          <a class="social-link" href="https://github.com/chentianyuan" target="_blank">
            <i class="fab fa-github"></i>
          </a>
        
      
        
      
        
      
        
          <a class="social-link" href="https://www.zhihu.com/people/chen-xiao-sa-30/activities" target="_blank">
            <i class="fab fa-zhihu"></i>
          </a>
        
      
        
      
    </div>
    <div class="site-description">
      è„šè¸å®åœ° ä»°æœ›æ˜Ÿç©º
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://chentianyuan.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">md-loaderè¯¦è§£</h2>
            <div class="post-date">2020-02-14</div>
            
              <div class="feature-container" style="background-image: url('https://chentianyuan.github.io/post-images/md-loader-xiang-jie.jpeg')">
              </div>
            
            <div class="post-content">
              <p>æ²¡æœ‰ä½ çš„æ—¥å­é‡Œï¼Œæˆ‘çœŸçš„å¥½æƒ³ä½ <br>
æ¯äº†ï¼Œå¹´å‰1æœˆ20é€ä¿®çš„ç”µè„‘ï¼Œä¸€ä¸ªæœˆäº†æ‰æ‹¿å›æ¥ğŸ¤•</p>
<!-- more -->
<p>è¿™ç¯‡æ–‡ç« åŠ å¼ºè®¤çŸ¥çš„åŒæ—¶ï¼Œä½¿ç”¨ä¸€ä¸‹staræ³•åˆ™ï¼ŒåŠ å¼ºè¡¨è¾¾èƒ½åŠ›</p>
<h2 id="situation-æƒ…æ™¯">situation æƒ…æ™¯</h2>
<p>å…¬å¸çš„ç»„ä»¶åº“å‡ºç¬¬äºŒç‰ˆäº†ï¼ŒæŠ€æœ¯æ ˆæ˜¯vue2.6+tsï¼Œé¡¹ç›®å†™åˆ°å¿«è¦éªŒæ”¶çš„é˜¶æ®µï¼Œé—®é¢˜å‡ºç°äº†ã€‚ç»„ä»¶åº“çš„æ–‡æ¡£åœ¨ç›´æ¥ä½¿ç”¨markdown-loaderè§£æmdçš„æƒ…å†µä¸‹ï¼Œå‡ºç°äº†mdå’Œdemoä¸å¯¹åº”çš„æƒ…å†µã€‚ï¼ˆæœ‰äº›å¼€å‘è€…ï¼ˆå¥½å§å°±æ˜¯æˆ‘è‡ªå·±ã€‚ã€‚ï¼‰ç»„ä»¶å†™å®Œï¼Œæ–‡æ¡£å†™å®Œï¼Œå‘ç°è¿˜è¦å†™.vueçš„demoç»„ä»¶ï¼Œåœ¨æœ¬èº«è¿˜æœ‰ç¹æ‚ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå¼€å§‹ç„¦èºä¸å·²ï¼Œdemoä¹Ÿå°±è‰è‰äº†äº‹äº†ï¼‰ï¼Œå¯¹ä¸€äº›å¤æ‚ç»„ä»¶ï¼Œä¸€ä¸ªä¸å’Œæ–‡æ¡£å¯¹åº”çš„demoï¼Œè·Ÿæ²¡æœ‰ä¸€æ ·ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æŠŠç›®å…‰ç„å‘äº†æ–‡æ¡£demoå¯¹åº”çš„element-uiã€‚</p>
<h2 id="task-ä»»åŠ¡">task ä»»åŠ¡</h2>
<p>ä»»åŠ¡å°±æ˜¯åˆ›å»ºå‡ºä¸€å¥—mdå’Œdemoå¯¹åº”çš„ç»„ä»¶æ–‡æ¡£ã€‚</p>
<h2 id="action-æ‰§è¡Œ">action æ‰§è¡Œ</h2>
<p>ç¡®è®¤è¿‡çœ¼ç¥ï¼Œæˆ‘é‡ä¸Šå¯¹çš„loaderã€‚çœ‹åˆ°elementç”¨mdä½œä¸ºvue-routerçš„è·¯ç”±ç»„ä»¶çš„æ—¶å€™ï¼Œelement-uiçš„md-loaderåº”è¯¥å°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ã€‚<br>
mdä¸­ä½¿ç”¨</p>
<pre><code>::: demo
```html
&lt;action-sheet&gt;...&lt;/actionsheet&gt;
export default { ... }
\```
:::
</code></pre>
<p>åŒ…è£¹çš„ä¸œè¥¿æœ€åä¼šè½¬æˆæˆ‘ä»¬çš„demoï¼Œå› æ­¤æˆ‘ä»¬åªè¦å†™ä¸€ä»½mdå°±èƒ½å¾—åˆ°demoå’Œæ–‡æ¡£äº†ã€‚</p>
<h3 id="md-loader">md-loader</h3>
<p>ä¸€ä¸ªwebpack loaderè¯´ç™½äº†å…¶å®å°±æ˜¯ä¸€ä¸ªæ¥å—sourceçš„functionï¼Œå‡½æ•°å¤„ç†sourceä¹‹åï¼Œè¿”å›ä¸€ä¸ªæ–°çš„sourceäº¤ç»™ä¸‹ä¸ªloaderå¤„ç†ã€‚</p>
<h3 id="æ¥åº·åº·md-loaderçš„å¤„ç†é¡ºåº">æ¥åº·åº·md-loaderçš„å¤„ç†é¡ºåº</h3>
<p>1ã€è·å–å¤„ç†å¥½çš„md<br>
è¿™è¾¹åˆ†å‡ ç§æƒ…å†µ</p>
<ul>
<li>æ™®é€šçš„mdè¯­æ³• äº¤ç”±markdown-itæ¥è§£æï¼Œå¾—åˆ°æ ‡ç­¾åŒ…è£¹å¥½çš„æ–‡æœ¬</li>
<li>å¯¹äºè¢«:::demoæ‰€åŒ…è£¹çš„sfcè¯­æ³•ï¼Œè¿›è¡Œä¸¤æ­¥æ“ä½œã€‚
<ul>
<li>å°†è¿™éƒ¨åˆ†ä»£ç ç”¨<code>&lt;!--element-demo: :element-demo--&gt;</code>åŒ…è£¹ï¼Œè¿™ä¸ªå±äºä¸€ä¸ªå ä½ç¬¦ï¼Œåœ¨æˆ‘ä»¬éå†demoæ—¶ä¾¿æ˜¯ä»¥è¿™ä¸ªæ¥æ ‡è¯†demoä»£ç çš„èµ·ç‚¹å’Œç»ˆç‚¹çš„</li>
<li>å†ä½¿ç”¨<code>&lt;demo-block&gt;...&lt;/demo-block&gt;</code>åŒ…è£¹</li>
<li>å¾—åˆ°ä¸€ä»½æ–°çš„md</li>
<li>é’ˆå¯¹æ–°çš„mdï¼Œæ”¹å˜markdownå¯¹demoå—çš„å¤„ç†æ–¹å¼ï¼Œå¹¶æ”¾å…¥<code>&lt;template slot=&quot;highlight&quot;&gt;</code>ä¸­ï¼Œä½œä¸ºä»£ç å±•ç¤ºéƒ¨åˆ†</li>
</ul>
<pre><code>if (token.info === 'html' &amp;&amp; isInDemoContainer) {
  return `&lt;template slot=&quot;highlight&quot;&gt;&lt;pre v-pre&gt;&lt;code class=&quot;html&quot;&gt;${md.utils.escapeHtml(token.content)}&lt;/code&gt;&lt;/pre&gt;&lt;/template&gt;`;
}
</code></pre>
<ul>
<li><code>md.render(source)</code> å¾—åˆ°æœ€åçš„ä»£ç å—</li>
</ul>
</li>
</ul>
<p>2ã€å¤„ç†ä»£ç å—ï¼Œå°†å…¶å˜æˆvue-loaderèƒ½å¤Ÿå¤„ç†çš„æ¨¡æ ·<br>
å…¶å®ï¼Œå¦‚æœmdä¸­åªæœ‰ä¸€ä¸ªdemoï¼Œæ ¹æœ¬æ²¡æœ‰å¿…è¦è¿›è¡Œè¿™æ­¥å¤„ç†ï¼Œå°†æ¨¡æ¿ç›´æ¥å¡å…¥sourceï¼Œäº¤ç»™vue-loaderå¤„ç†å°±å¥½äº†ã€‚å¯æ˜¯ç†æƒ³å¾ˆç¾å¥½ï¼Œç°å®å¾ˆéª¨æ„Ÿï¼Œæ¯ä¸ªmdä¸€èˆ¬ä¼šæœ‰å¤šä¸ªdemoå—ï¼Œå¦‚æœå…±ç”¨ä¸€ä»½çŠ¶æ€ï¼Œå¿…é¡»æ··åˆçŠ¶æ€ï¼Œä¸”çŠ¶æ€åä¸èƒ½é‡å¤ï¼Œéå¸¸ä¸æ–¹ä¾¿ï¼Œå› æ­¤md-loaderæ˜¯è¿™æ ·å¤„ç†çš„ã€‚</p>
<pre><code>const demoComponentName = `element-demo${id}`;
output.push(`&lt;template slot=&quot;source&quot;&gt;&lt;${demoComponentName} /&gt;&lt;/template&gt;`);
</code></pre>
<p>å¯¹æ¯ä¸ªå—æ’å…¥ä¸€ä¸ª<code>element-demo${id}</code>ç»„ä»¶ï¼Œç„¶åè¿™ä¸ªç»„ä»¶ï¼Œå°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦ç”Ÿæˆçš„äº†ï¼Œç¡®ä¿äº†æ¯ä¸ªdemoéƒ½æ˜¯ç‹¬ç«‹äº’ä¸å¹²æ‰°çš„ã€‚æœ€åè¿™äº›ç»„ä»¶ä¼šé€šè¿‡æ’æ§½çš„å½¢å¼ï¼Œæ’å…¥demo-blockç»„ä»¶æä¾›çš„æ§½ä½ä¸­ã€‚</p>
<h3 id="ç”Ÿæˆelement-demoidç»„ä»¶çš„renderå‡½æ•°">ç”Ÿæˆelement-demo${id}ç»„ä»¶çš„renderå‡½æ•°</h3>
<p>ä¾èµ–çš„ä¸¤ä¸ªåº“åˆ†åˆ«æ˜¯<code>@vue/component-compiler-utils</code>å’Œ<code>vue-template-compiler</code>ï¼Œ</p>
<ul>
<li><code>let demoComponentContent = genInlineComponentText(html, script);</code> é€šè¿‡genInlineComponentTextå‡½æ•°ç”Ÿæˆæˆ‘ä»¬æ‰€éœ€çš„ç»„ä»¶ä»£ç </li>
<li>å°†åˆæ³•çš„optionsä¼ ç»™<code>@vue/component-compiler-utils</code>ä¸­æä¾›çš„<code>compileTemplate</code>å‡½æ•°</li>
</ul>
<pre><code class="language-javascript">  const finalOptions = {
    source: `&lt;div&gt;${template}&lt;/div&gt;`,
    filename: 'inline-component', // TODOï¼šè¿™é‡Œæœ‰å¾…è°ƒæ•´
    compiler
  };
  const compiled = compileTemplate(finalOptions);
  let demoComponentContent = `
    ${compiled.code}
  `;
  demoComponentContent = `(function() {
    ${demoComponentContent}
    ${script}
    return Object.assign({
      render,
      staticRenderFns
    }, democomponentExport)
  })()`;
  return demoComponentContent;
</code></pre>
<ul>
<li>æœ€åçš„demoComponentContentå°±æ˜¯æˆ‘ä»¬è¦çš„scriptäº†~<br>
ä¸¾ä¸ªä¾‹å­ï¼Œæœ€åçš„demoComponentContentçš„æ ·å­ç±»ä¼¼è¿™æ ·</li>
</ul>
<pre><code class="language-javascript">&quot;element-demo0&quot;: (function () {
    var render = function (_c) { return _c(....) }
    var staticRenderFns = []
    const democomponentExport = {
        data () {
            return {
            value1: false,
            actions1: [
                { value: 1, label: 'é¡¹ç›®1' }, 
                { value: 2, label: 'é¡¹ç›®2' }, 
                { value: 3, label: 'é¡¹ç›®3' }
            ]
            }
        },
        ...options
    }
    return Object.assign({
        render,
        staticRenderFns
    }, democomponentExport)
})
</code></pre>
<h2 id="result-ç»“æœ">result ç»“æœ</h2>
<p>å°†ç”Ÿæˆçš„æ¨¡æ¿ï¼Œå’Œå¾—åˆ°çš„element-demo${id}ç»„ä»¶scriptä¸€èµ·ï¼Œæ’å…¥åˆ°æ–°çš„æ¨¡æ¿ä¸­</p>
<pre><code class="language-javascript">// md-loader
  return `
    &lt;template&gt;
      &lt;section class=&quot;content wand-doc&quot; :class=&quot;'wand-doc-' + $route.fullPath.substring(1)&quot;&gt;
        ${output.join('')}
      &lt;/section&gt;
    &lt;/template&gt;
    ${pageScript}
  `;
</code></pre>
<p>ä¸‹ä¸€æ­¥ä¾¿ç”±vue-loaderå¤„ç†äº†ï¼Œç”Ÿæˆæ•´ä¸ªè·¯ç”±ç»„ä»¶çš„renderå‡½æ•°å¹¶åœ¨è·¯ç”±è®¿é—®æ—¶æ‰§è¡Œå¹¶æŒ‚è½½åˆ°é¡µé¢ä¸Šï¼æœ€åæˆ‘ä»¬çœ‹åˆ°çš„æ–‡æ¡£å’Œdemoå°±æ˜¯ä¸€ä¸€å¯¹åº”çš„äº†ï¼Œçœ‹èµ·æ¥éå¸¸å¾—ç›´è§‚ã€‚<br>
<img src="https://chentianyuan.github.io/post-images/1581670429040.png" alt="" loading="lazy"><br>
å®Œæˆï¼</p>

            </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://chentianyuan.github.io/post/js-la-ji-hui-shou-ji-zhi/">
                  <h3 class="post-title">
                    jsåƒåœ¾å›æ”¶æœºåˆ¶
                  </h3>
                </a>
              </div>
            

            
              
                <div id="gitalk-container" data-aos="fade-in"></div>
              

              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>

<script type="application/javascript">

AOS.init();

hljs.initHighlightingOnLoad()

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>



  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: 'c56a51c05f5b5d771fd3',
        clientSecret: '60ee440f298d2fb1c5ba92f3236b618bd749de24',
        repo: 'chentianyuan.github.io',
        owner: 'chentianyuan',
        admin: ['chentianyuan'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
